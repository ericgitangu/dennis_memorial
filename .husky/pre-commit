#!/usr/bin/env sh

# 1. Secret scanning
if command -v gitleaks >/dev/null 2>&1; then
  echo "ğŸ” Scanning for secrets..."
  if ! gitleaks protect --staged --config .gitleaks.toml --verbose 2>/dev/null; then
    echo "âŒ Potential secrets detected!"
    exit 1
  fi
  echo "âœ… No secrets detected"
else
  echo "âš ï¸  gitleaks not installed - skipping. Install: brew install gitleaks"
fi

# 2. TypeScript check
echo "ğŸ”· Running TypeScript check..."
if ! pnpm tsc --noEmit 2>/dev/null; then
  echo "âŒ TypeScript errors found."
  exit 1
fi
echo "âœ… TypeScript passed"

# 3. ESLint strict (zero warnings)
echo "ğŸ“ Running ESLint..."
if ! pnpm eslint . --ext .ts,.tsx --quiet --max-warnings 0 2>/dev/null; then
  echo "âŒ ESLint errors found."
  exit 1
fi
echo "âœ… ESLint passed"

# 4. Prettier check
echo "ğŸ¨ Checking formatting..."
if ! pnpm prettier --check "src/**/*.{ts,tsx,css,json}" 2>/dev/null; then
  echo "âŒ Formatting issues. Run: pnpm prettier --write \"src/**/*.{ts,tsx,css,json}\""
  exit 1
fi
echo "âœ… Formatting passed"

echo "âœ… Pre-commit checks passed"
