#!/usr/bin/env sh

RANGE=$(git log --oneline @{u}..HEAD 2>/dev/null | wc -l | tr -d ' ')
if [ "$RANGE" = "0" ]; then
  echo "‚úÖ Nothing to push"
  exit 0
fi

echo "üèóÔ∏è  Running pre-push verification..."

# Full production build
echo "  ‚Üí Building Next.js..."
if ! pnpm build 2>/dev/null; then
  echo "‚ùå Build failed. Fix before pushing."
  exit 1
fi
echo "‚úÖ Build passed"

# Test suite
echo "  ‚Üí Running tests..."
if ! pnpm test --run 2>/dev/null; then
  echo "‚ö†Ô∏è  Tests failed (non-blocking)"
fi

echo "‚úÖ Pre-push verification complete"
